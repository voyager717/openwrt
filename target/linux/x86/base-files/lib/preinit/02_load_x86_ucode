#!/bin/sh
# Copyright (C) 2018 OpenWrt.org

do_load_x86_ucode() {
	if grep -q AuthenticAMD /proc/cpuinfo; then
		if [ -e "/sys/devices/system/cpu/microcode/reload" ]; then
			echo 1 > /sys/devices/system/cpu/microcode/reload
		fi
	fi
}

boot_hook_add preinit_main do_load_x86_ucode
