# Copyright (C) 2015 OpenWrt.org

. /lib/upgrade/common.sh

<<<<<<< HEAD
move_config() {
	local partdev

	export_bootdevice && export_partdevice partdev 1 || {
		partdev=mmcblk0p1
	}

	if [ -b "/dev/$partdev" ]; then
=======
BOOTPART=/dev/mmcblk0p1

move_config() {
	if [ -b $BOOTPART ]; then
>>>>>>> 712839d4c6 (Removed unwanted submodules from index)
		insmod nls_cp437
		insmod nls_iso8859-1
		insmod fat
		insmod vfat
		mkdir -p /boot
<<<<<<< HEAD
		mount -t vfat -o rw,noatime /dev/$partdev /boot
		if [ -f "/boot/$BACKUP_FILE" ]; then
			mv -f "/boot/$BACKUP_FILE" /
			export BCM27XX_SET_ROOT_PART=1
		fi
=======
		mount -t vfat -o rw,noatime $BOOTPART /boot
		[ -f "/boot/$BACKUP_FILE" ] && mv -f "/boot/$BACKUP_FILE" /
>>>>>>> 712839d4c6 (Removed unwanted submodules from index)
	fi
}

boot_hook_add preinit_mount_root move_config
